<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PulseMind™ Demo (Limited)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;max-width:900px;margin:40px auto;padding:0 16px;line-height:1.5}
    h1{font-size:1.6rem} h2{font-size:1.2rem;margin-top:1.6rem}
    .card{border:1px solid #e6e6e6;border-radius:12px;padding:16px;margin:12px 0}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row > *{flex:1 1 260px}
    textarea{width:100%;min-height:160px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    button{padding:10px 14px;border-radius:10px;border:1px solid #ddd;background:#fafafa;cursor:pointer}
    button.primary{background:black;color:white}
    .kpi{font-size:1.4rem;font-weight:700}
    .muted{color:#666}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#efefef;margin-left:6px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .grid > div{border:1px dashed #e3e3e3;border-radius:8px;padding:12px}
    .small{font-size:.9rem}
    .footer{margin-top:24px;color:#777;font-size:.9rem}
    input[type=file]{display:none}
    label.file{border:1px solid #ddd;border-radius:8px;padding:8px 12px;display:inline-block;cursor:pointer;background:#fff}
    pre{white-space:pre-wrap;background:#fbfbfb;border:1px solid #eee;border-radius:8px;padding:12px}
  </style>
</head>
<body>
  <h1>PulseMind™ Demo <span class="badge">Limited</span></h1>
  <p class="muted">Concept demo with simplified logic. No proprietary model weights or production logic included.</p>

  <div class="card">
    <div class="row">
      <div>
        <h2>1) Load sample data</h2>
        <p class="small muted">Use the sample below or upload your own JSON with fields: date, hr_rest, rmssd, sleep_hours, load.</p>
        <div class="row">
          <button id="loadSample">Load sample_week.json</button>
          <label class="file"><input id="file" type="file" accept="application/json">Upload JSON…</label>
          <button id="clear">Clear</button>
        </div>
        <textarea id="json" placeholder='[{"date":"2025‑08‑25","hr_rest":52,"rmssd":58,"sleep_hours":7.3,"load":320}, …]'></textarea>
      </div>
      <div>
        <h2>2) Evaluate</h2>
        <p class="small muted">Runs a simplified readiness & overload mock.</p>
        <div class="row">
          <button id="eval" class="primary">Evaluate</button>
        </div>
        <div class="grid">
          <div>
            <div class="muted small">Readiness Score</div>
            <div id="ready" class="kpi">–</div>
          </div>
          <div>
            <div class="muted small">Overload Risk</div>
            <div id="risk" class="kpi">–</div>
          </div>
        </div>
        <h2>Notes</h2>
        <ul class="small">
          <li>Readiness: 0–100 (higher = better). Mocked from normalized HRV, sleep, and recent load.</li>
          <li>Risk: "Low / Moderate / High" based on acute:chronic load and HRV drift.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Debug Output</h2>
    <pre id="log">Ready.</pre>
  </div>

  <div class="footer small">© PulseMind™ Demo • For evaluation only.</div>

<script>
async function fetchSample(){
  const res = await fetch('data/sample_week.json');
  const txt = await res.text();
  document.getElementById('json').value = txt;
}
document.getElementById('loadSample').onclick = fetchSample;
document.getElementById('clear').onclick = () => { document.getElementById('json').value=''; setKPIs('–','–'); log('Cleared.'); };
document.getElementById('file').addEventListener('change', (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => document.getElementById('json').value = reader.result;
  reader.readAsText(file);
});

function setKPIs(rdy, risk){ document.getElementById('ready').textContent=rdy; document.getElementById('risk').textContent=risk; }
function log(msg){ const el = document.getElementById('log'); el.textContent = String(msg); }

function evaluate(data){
  // Simplified feature extraction
  const n = data.length;
  const avg = arr => arr.reduce((a,b)=>a+b,0)/arr.length;

  const hrvs = data.map(d=>Number(d.rmssd||0));
  const sleeps = data.map(d=>Number(d.sleep_hours||0));
  const loads = data.map(d=>Number(d.load||0));

  const hrvAvg = avg(hrvs);
  const sleepAvg = avg(sleeps);
  const loadSum = loads.reduce((a,b)=>a+b,0);

  // Readiness mock: normalized weighted sum
  const norm = (x,min,max)=> Math.max(0, Math.min(1, (x-min)/(max-min)));
  const hrvScore = norm(hrvAvg, 20, 90);
  const sleepScore = norm(sleepAvg, 4.5, 9);
  // Lower load -> higher readiness
  const loadScore = 1 - norm(loadSum/n, 150, 600);

  const readiness = Math.round(100*(0.5*hrvScore + 0.3*sleepScore + 0.2*loadScore));

  // Overload risk mock: acute:chronic like ratio with HRV drift
  const k = Math.min(7, n);
  const recent = loads.slice(-k);
  const acute = avg(recent);
  const chronic = avg(loads);
  const ratio = chronic > 0 ? acute/chronic : 1;

  const hrvDrift = (hrvs[hrvs.length-1] || hrvAvg) - hrvAvg; // last vs mean
  let risk = "Low";
  if (ratio > 1.3 || hrvDrift < -8) risk = "Moderate";
  if (ratio > 1.6 || hrvDrift < -15) risk = "High";

  return {readiness, risk, details:{hrvAvg, sleepAvg, loadAvg: avg(loads), ratio, hrvDrift}};
}

document.getElementById('eval').onclick = () => {
  try{
    const txt = document.getElementById('json').value.trim();
    const data = JSON.parse(txt);
    const out = evaluate(data);
    setKPIs(out.readiness, out.risk);
    log(JSON.stringify(out, null, 2));
  }catch(err){
    setKPIs('–','–');
    log('Invalid JSON: ' + err.message);
  }
};
</script>
</body>
</html>
